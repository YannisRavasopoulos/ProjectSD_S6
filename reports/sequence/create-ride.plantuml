@startuml

actor Driver

participant HomeView
participant Navigator
participant LoopApp
participant CreateRideView
participant CreateRideViewModel
participant ActivitySelectionPanel
participant RideRepository



' Main flow: Driver starts creating a ride
activate LoopApp
activate HomeView
Driver -> HomeView: Presses "Create Ride"
HomeView -> HomeView: onCreateRideClick()
HomeView -> Navigator: pushNamed("/create-ride")
activate Navigator
Navigator -> LoopApp: "/create-ride"
LoopApp -> CreateRideViewModel: new CreateRideViewModel(...)
activate CreateRideViewModel
LoopApp -> CreateRideView: new CreateRideView(createRideViewModel)
activate CreateRideView
CreateRideView --> LoopApp: return createRideView
LoopApp --> Navigator: return createRideView
Navigator -> CreateRideView: build(context)


alt Make Insta-Ride
    Driver -> CreateRideView: Fills ride form fields

    ' Driver confirms creation
    Driver -> CreateRideView: Presses "Create Ride"
    CreateRideView -> CreateRideViewModel: createRide()
    CreateRideViewModel -> RideRepository: create(ride)
    activate RideRepository
    RideRepository --> CreateRideViewModel: return
    deactivate RideRepository
' Activity selection (alternative flow)
else Select from activities
    Driver -> CreateRideView: Presses "Select from activities"
    CreateRideView -> ActivitySelectionPanel: showModalBottomSheet(activities)
    activate ActivitySelectionPanel
    Driver -> ActivitySelectionPanel: Selects activity
    ActivitySelectionPanel -> CreateRideView: onActivitySelected(activity)
      deactivate ActivitySelectionPanel
    CreateRideView -> CreateRideViewModel: selectActivity(activity)
    CreateRideViewModel -> CreateRideViewModel: update form fields (from, to, times)
  
end

' Driver fills in the form (from, to, times)


alt Success
    CreateRideViewModel -> CreateRideView: notifyListeners() (showSuccess)
    CreateRideView -> Driver: Show "Ride created successfully!"
else Error
    CreateRideViewModel -> CreateRideView: notifyListeners() (errorMessage)
    CreateRideView -> Driver: Show error message
end

deactivate CreateRideViewModel
deactivate CreateRideView

@enduml
